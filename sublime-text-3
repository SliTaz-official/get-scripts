SHORT_DESC="Sophisticated text editor for code, markup and prose"
WEB_SITE="http://www.sublimetext.com/3"
# end of get.list data
CATEGORY="development"
MAINTAINER="al.bobylev@gmail.com"
LICENSE="non-free"
WGET_URL="$(wget -O - $WEB_SITE | tr '"' '\n' | fgrep x32.tar)"
VERSION=${WGET_URL%_x32*}; VERSION=${VERSION##*_}
TARBALL="$(basename $WGET_URL)"

busybox wget $WGET_URL
[ -f $TARBALL ] || abort_package "Could not download $TARBALL from $WGET_URL. Exiting."

mkdir -p $PACKAGE-$VERSION/fs/opt $PACKAGE-$VERSION/fs/usr/share/applications
cd $PACKAGE-$VERSION/fs/opt
tar -xjf ../../../$TARBALL
mv sublime_text_3 sublime_text
mv sublime_text/sublime_text.desktop ../usr/share/applications

# link icons
for size in $(cd sublime_text/Icon; ls); do
	mkdir -p ../usr/share/icons/hicolor/$size/apps
	ln -fs /opt/sublime_text/Icon/$size/sublime-text.png \
		../usr/share/icons/hicolor/$size/apps/sublime-text.png
done
