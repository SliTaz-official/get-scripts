SHORT_DESC="Official Firefox build by the Mozilla foundation."
WEB_SITE="http://www.mozilla.org/firefox"
CATEGORY="network"
LICENSE="MPL2"
# end of get.list data
URL="http://ftp.mozilla.org/pub/mozilla.org/firefox/releases/?C=M;O=D"
VERSION=$(wget -O - $URL | sed \
	  '/href="[0-9\./]*"/!d;s|.*href="[^"]*">\([^</]*\).*|\1|;q')
[ "$1" == "--get-version" ] && echo $VERSION && exit
SOURCE="firefox"
TARBALL="$SOURCE-$VERSION.tar.bz2"
WGET_URL="${URL%\?*}$VERSION/linux-i686/en-US/$TARBALL"
TAGS="web-browser"
HOST_ARCH="i486"
DEPENDS="gtk+"

wget $WGET_URL
[ -f $TARBALL ] ||
abort_package "Could not download $TARBALL from $WGET_URL. Exiting."

DESTDIR=$PWD/$PACKAGE-$VERSION/fs

mkdir -p \
	$DESTDIR/usr/bin \
	$DESTDIR/usr/lib/firefox-$VERSION \
	$DESTDIR/usr/share/applications \
	$DESTDIR/usr/share/pixmaps
tar xjf $TARBALL -C $DESTDIR/usr/lib/firefox-$VERSION
# /usr/bin/firefox-official + pixmap
cd $DESTDIR/usr/bin
ln -s $(find ../lib/firefox-$VERSION | sed '/firefox-bin$/!dq) $PACKAGE
cd $DESTDIR/usr/share/pixmaps
ln -s $(find ../../lib/firefox-$VERSION | sed '/zicon128.png$/!dq) $PACKAGE.png
cat > $DESTDIR/usr/share/applications/$PACKAGE <<EOT
[Desktop Entry]
Encoding=UTF-8
Name=Firefox Web Browser (official)
Name[fr]=Navigateur web Firefox (officiel)
Exec=firefox-official
Icon=firefox-official
Type=Application
Categories=Application;Network;
EOT
# Remove updater files (users can't upgrade anyway)
rm -f $DESTDIR/usr/lib/firefox-$VERSION/update*
