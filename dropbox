SHORT_DESC="Dropbox daemon and client for online storage."
WEB_SITE="http://www.dropbox.com"
# end of get.list data
DEPENDS="python"
SUGGESTED="ntlmaps"
PLATFORM="lnx.x86"	# or lnx.x86_64
TARBALL=$PACKAGE-$PLATFORM.tar.gz
WGET_URL="$WEB_SITE/download/?plat=$PLATFORM"

# Download the file
wget --no-check-certificate -O $TARBALL $WGET_URL 

[ -f $TARBALL ] || abort_package "Could not download $TARBALL. Exiting."

tar xzf $TARBALL
# extracted pkg can be removed: Save RAM
rm -f $TARBALL
VERSION="$(cat $tmp_dir/.dropbox-dist/VERSION)"

mkdir -p $PACKAGE-$VERSION/fs/usr/lib \
	$PACKAGE-$VERSION/fs/usr/bin \
	$PACKAGE-$VERSION/fs/usr/share/applications \
	$PACKAGE-$VERSION/fs/usr/share/pixmaps 

mv $tmp_dir/.dropbox-dist $PACKAGE-$VERSION/fs/usr/lib/dropbox
mv -f $PACKAGE-$VERSION/fs/usr/lib/dropbox/dropbox-$PLATFORM*/* \
	$PACKAGE-$VERSION/fs/usr/lib/dropbox

# Desktop file
cat > $PACKAGE-$VERSION/fs/usr/share/applications/dropbox.desktop << EOT
[Desktop Entry]
Type=Application
Name=Dropbox Storage
Exec=dropboxd
Icon=dropbox
Terminal=false
Categories=Network;FileTransfer;
EOT

# Symlink to have Dropbox in PATH and fake nautilus
cd $PACKAGE-$VERSION/fs/usr/bin
rm -f dropboxd nautilus
ln -s ../lib/dropbox/dropboxd .
ln -s /usr/bin/pcmanfm nautilus
cd ..
ln $(find lib | sed '/logo\.png$/!d;q') share/pixmaps/dropbox.png

cd $tmp_dir
